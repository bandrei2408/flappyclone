<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="js/jquery-2.0.3.min.js" type="text/javascript"></script>
        <script src="js/phaser.min.js"></script>
    </head>
    <body>

    <script type="text/javascript">

    window.onload = function() {

        var game = new Phaser.Game(800, 600, Phaser.CANVAS, '', { preload: preload, create: create, update: update });
        var bg;
        var platforms;
        var obstacles;
        var player;
        var cursors;
        var camera;
        var lastX;

        function preload () {

            game.load.image('background', 'assets/bg.png');
            game.load.image('ground','assets/ground.png');
            game.load.image('obstacle_bot_small','assets/ob_small_bot.png');
            game.load.image('obstacle_top_large','assets/ob_large_top.png');
            game.load.image('obstacle_top_small','assets/ob_small_top.png');
            game.load.image('obstacle_bot_large','assets/ob_large_bot.png');
            game.load.spritesheet('bat','assets/bat.png',52,54);

        }

        function create () {
            game.stage.backgroundColor = '#000000';

            bg = game.add.tileSprite(-90000, -64, 90800, 600, 'background');

            obstacles = game.add.group();
            platforms = game.add.group();
            
            var obstacle = obstacles.create(0,game.world.height - 64 - 145 + 15,'obstacle_bot_small');
            var obstacle2 = obstacles.create(12,-10,'obstacle_top_large');
            //var obstacle3 = obstacles.create(4,-10,'obstacle_top_small');
            //var obstacle4 = obstacles.create(0,game.world.height - 64 - 240 + 10,'obstacle_bot_large');
            obstacle.body.immovable = true;
            obstacle2.body.immovable = true;
            //obstacle3.body.immovable = true;
            //obstacle4.body.immovable = true;

            lastX = 0;

            var ground = platforms.create(800, game.world.height - 64, 'ground');
            ground.body.immovable = true;
            ground.scale.setTo(-10000, 2);

            player = game.add.sprite(750,280, 'bat');
            player.body.gravity.y = 800;
            player.body.bounce.y = 0.1;

            cursors = game.input.keyboard;
            game.world.setBounds(-90000,0,90800,600);
            game.camera.follow(player);
            
        }

        function update(){
            game.physics.collide(player, platforms);
             player.body.velocity.x = -350;
            
             if (cursors.isDown(Phaser.Keyboard.SPACEBAR))
            {
                player.body.velocity.y = -300;
            }

            console.log(player.body.x);
            choice = Math.floor((Math.random()*2)+1);

            if(Math.floor(player.body.x) >= (lastX + 700) && Math.floor(player.body.x) <= (lastX + 707)){
                distance = Math.floor((Math.random()*400)+1);
                if ( choice == 1){
                    var obstacle = obstacles.create(lastX - 100 - distance,game.world.height - 64 - 145 + 15,'obstacle_bot_small');
                    var obstacle2 = obstacles.create(lastX - 100 - distance + 12,-10,'obstacle_top_large');
                } else {
                    var obstacle = obstacles.create(lastX + 4 - 100 - distance,-10,'obstacle_top_small');
                    var obstacle2 = obstacles.create(lastX - 100 - distance ,game.world.height - 64 - 240 + 10,'obstacle_bot_large');
                }
                obstacle.body.immovable = true;
                obstacle2.body.immovable = true;
                lastX = lastX - 100 - distance;
            }


        }

    };

    </script>

    </body>
</html>